!function(T,g,I){"use strict";function t(t,A){this.position=t,this.$22n=A}var M="ht",Y=T[M],k=null,Q=Math,i=Q.PI,h=Q.cos,K=Q.sin,O=Q.abs,l=Q.max,C=Q.sqrt,n=1e-5,V=Y.Default,y=V.def,N=V.startAnim,D=V.createMatrix,v=V.transformVec,X=V.getInternal(),H=X.addMethod,B=X.superCall,E=X.toPointsArray,d=X.createNormals,q=X.toFloatArray,L=X.glMV,G=(X.glPop,Y.graph3d.Graph3dView,Y.Math),f=G.Vector3,W=G.Matrix4,$=G.Euler,R=(G.Quaternion,X.batchShape),u=X.createNodeMatrix,J=X.getFaceInfo,U=X.transformAppend,Z=X.drawFaceInfo,o=X.createAnim,_=X.cube(),x=_.is,F=_.vs,A=_.uv,z=X.ui(),r=Y.Node,m=Y.Shape,c="h",e="v",s="front",p="back",b="left",j="right",w="top",S="bottom",P="dw.expanded",a=".expanded",sl="dw.angle",Xp=".angle",Ee=function(U,f,S){y(M+"."+U,f,S)},Wl=function(o,K,R){R?o.push(K.x,K.y):o.push(K.x,K.y,K.z)},Wp=function(){var R=new Y.Math.Vector3,J=new Y.Math.Vector3,P=new Y.Math.Vector3;return function(S,C,L,O,K){if(R.copy(C.$24n),J.copy(L.$24n),P.copy(O.$24n),!(P.equals(R)||J.equals(R)||J.equals(P))){if(!C.$22n||!L.$22n||!O.$22n){var T=J.sub(R).cross(P.sub(R)).normalize().multiplyScalar(1).toArray();C.$22n||(C.$22n=new oq(T)),L.$22n||(L.$22n=new oq(T)),O.$22n||(O.$22n=new oq(T))}S.push(new _r([C,L,O],K))}}}(),wr=function(g,c,w,G){var j,m,L,E,s=0,Y=[];if(G)for(j=G.length;j>s;s+=3)m=G[s],L=G[s+1],E=G[s+2],Wp(Y,new kq([c[3*m],c[3*m+1],c[3*m+2]],null,w?[w[2*m],w[2*m+1],0]:k),new kq([c[3*L],c[3*L+1],c[3*L+2]],null,w?[w[2*L],w[2*L+1],0]:k),new kq([c[3*E],c[3*E+1],c[3*E+2]],null,w?[w[2*E],w[2*E+1],0]:k),g);else for(j=c.length/3;j>s;s+=3)m=s,L=s+1,E=s+2,Wp(Y,new kq([c[3*m],c[3*m+1],c[3*m+2]],null,w?[w[2*m],w[2*m+1],0]:k),new kq([c[3*L],c[3*L+1],c[3*L+2]],null,w?[w[2*L],w[2*L+1],0]:k),new kq([c[3*E],c[3*E+1],c[3*E+2]],null,w?[w[2*E],w[2*E+1],0]:k),g);return Y},$l=[b,s,j,p,w,S],Nk=["",w,S],Kl=$l.concat("csg"),sn=[0,6,12,18,24,30],qh=function(m,U,b){var d=u(m),z=[];m.appendAnchorMatrix3d(d);var Y,n=U?U.getData3dUI(m):null;if(n&&n.s("shape3d")&&!n.s("csg.cull.box")&&(Y=n.shapeModel,n.shapeModel||(Y=X.getShapeModel(n,n.s("shape3d"))),Y))for(var j=X.createNormalMatrix(d),D=0,B=Nk.length;B>D;D++){var E=Nk[D],$=E.length?E+"_":E,O=Y[$+"vs"],T=Y[$+"uv"],G=Y[$+"is"],s=Y[$+"ns"];if(O&&O.length)for(var a,w,r,p=0,P=G?G.length:O.length/3;P>p;p+=3)G?(a=G[p],w=G[p+1],r=G[p+2]):(a=p,w=p+1,r=p+2),Wp(z,new kq(v([O[3*a],O[3*a+1],O[3*a+2]],d),s?v([s[3*a],s[3*a+1],s[3*a+2]],j):null,[T[2*a],T[2*a+1],0]),new kq(v([O[3*w],O[3*w+1],O[3*w+2]],d),s?v([s[3*w],s[3*w+1],s[3*w+2]],j):null,[T[2*w],T[2*w+1],0]),new kq(v([O[3*r],O[3*r+1],O[3*r+2]],d),s?v([s[3*r],s[3*r+1],s[3*r+2]],j):null,[T[2*r],T[2*r+1],0]),m)}if(!Y)for(var D=0;6>D;D++)for(var E=$l[D],f=sn[D],T=b?U.getFaceUv(m,E):k,C=b?U.getFaceUvScale(m,E):k,q=b?U.getFaceUvOffset(m,E):k,h=0;2>h;h++){var o,R,V,i=x[f+3*h],J=x[f+3*h+1],t=x[f+3*h+2];if(b){if(T){var M=8*D;o=[T[2*i-M],T[2*i+1-M],0],R=[T[2*J-M],T[2*J+1-M],0],V=[T[2*t-M],T[2*t+1-M],0]}else o=[A[2*i],A[2*i+1],0],R=[A[2*J],A[2*J+1],0],V=[A[2*t],A[2*t+1],0];C&&(o[0]*=C[0],o[1]*=C[1],R[0]*=C[0],R[1]*=C[1],V[0]*=C[0],V[1]*=C[1]),q&&(o[0]+=q[0],o[1]+=q[1],R[0]+=q[0],R[1]+=q[1],V[0]+=q[0],V[1]+=q[1])}Wp(z,new kq(v([F[3*i],F[3*i+1],F[3*i+2]],d),null,o),new kq(v([F[3*J],F[3*J+1],F[3*J+2]],d),null,R),new kq(v([F[3*t],F[3*t+1],F[3*t+2]],d),null,V),m)}return ch.$15n(z)},Mo=function(u,K){var o,O=u.data.getAttaches();if(O&&O.each(function(K){K instanceof ps&&K.s("attach.operation")&&(o||(o=[]),o.push(K))}),o){var f;$l.forEach(function(L){var V=wr(L,u[L].vs,u[L].tuv);f=f?f.concat(V):V}),f=ch.$15n(f),o.forEach(function(U){var K=U.s("attach.operation");f[K]&&(f=f[K](qh(U,u.gv,u.csg.tuv)))}),$l.forEach(function(s){s=u[s],s.vs=[],s.ns=[],s.tuv&&(s.tuv=[])}),u.csg&&!u.csg.ns&&(u.csg.ns=[]);var p=[];if(f.$19n().forEach(function(b){var r,Z=b.$10n;if(Z instanceof ps){if(Z.s("attach.cull"))return;r=Z.s("csg.cull.color"),r&&(r=X.toColorArray(r)),Z="csg"}for(var l=u[Z],g=l.vs,B=l.ns,h=l.tuv,D=b.$9n,H=2;H<D.length;H++)if(Wl(g,D[0].$24n),Wl(g,D[H-1].$24n),Wl(g,D[H].$24n),B&&(Wl(B,D[0].$22n),Wl(B,D[H-1].$22n),Wl(B,D[H].$22n)),h&&(Wl(h,D[0].uv,!0),Wl(h,D[H-1].uv,!0),Wl(h,D[H].uv,!0)),r)for(var M=4*(g.length/3),v=0;3>v;v++)p[--M]=r[3],p[--M]=r[2],p[--M]=r[1],p[--M]=r[0]}),p.length){for(var v=X.toColorArray(u.csg.color),l=0,G=4*(u.csg.vs.length/3);G>l;l+=4)p[l]==I&&(p[l]=v[0],p[l+1]=v[1],p[l+2]=v[2],p[l+3]=v[3]);u.csg.cs=p}}Kl.forEach(function(N){var M=u[N];M.visible&&M.vs.length?(M.ns&&M.ns.length?q(M,"ns"):M.ns=d(M.vs),q(M,"vs"),q(M,"tuv"),M.cs&&q(M,"cs")):delete u[N]}),K&&(R(u,k,K),u.clear())};H(V,{createFrameModel:function(d,O,C,X){d=d==k?.07:d,O=O==k?d:O,C=C==k?d:C,X=X?X:{};var q=X.top,a=X.bottom,V=X.left,f=X.right,Z=X.front,F=X.back,b=[],D=[];return Z===!0?(b.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),D.push(0,0,0,1,1,1,1,1,1,0,0,0)):Z===!1||(b.push(-.5,.5,.5,-.5,-.5,.5,-.5+d,-.5,.5,-.5+d,-.5,.5,-.5+d,.5,.5,-.5,.5,.5,.5-d,.5,.5,.5-d,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-d,.5,.5,-.5+d,.5,.5,-.5+d,.5-O,.5,.5-d,.5-O,.5,.5-d,.5-O,.5,.5-d,.5,.5,-.5+d,.5,.5,-.5+d,-.5+O,.5,-.5+d,-.5,.5,.5-d,-.5,.5,.5-d,-.5,.5,.5-d,-.5+O,.5,-.5+d,-.5+O,.5),D.push(0,0,0,1,d,1,d,1,d,0,0,0,1-d,0,1-d,1,1,1,1,1,1,0,1-d,0,d,0,d,O,1-d,O,1-d,O,1-d,0,d,0,d,1-O,d,1,1-d,1,1-d,1,1-d,1-O,d,1-O)),F===!0?(b.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),D.push(1,0,0,1,1,1,0,1,1,0,0,0)):F===!1||(b.push(-.5,.5,-.5,-.5+d,-.5,-.5,-.5,-.5,-.5,-.5+d,-.5,-.5,-.5,.5,-.5,-.5+d,.5,-.5,.5-d,.5,-.5,.5,-.5,-.5,.5-d,-.5,-.5,.5,-.5,-.5,.5-d,.5,-.5,.5,.5,-.5,-.5+d,.5,-.5,.5-d,.5-O,-.5,-.5+d,.5-O,-.5,.5-d,.5-O,-.5,-.5+d,.5,-.5,.5-d,.5,-.5,-.5+d,-.5+O,-.5,.5-d,-.5,-.5,-.5+d,-.5,-.5,.5-d,-.5,-.5,-.5+d,-.5+O,-.5,.5-d,-.5+O,-.5),D.push(1,0,1-d,1,1,1,1-d,1,1,0,1-d,0,d,0,0,1,d,1,0,1,d,0,0,0,1-d,0,d,O,1-d,O,d,O,1-d,0,d,0,1-d,1-O,d,1,1-d,1,d,1,1-d,1-O,d,1-O)),V===!0?(b.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),D.push(0,0,0,1,1,1,1,1,1,0,0,0)):V===!1||(b.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+C,-.5,-.5,-.5+C,-.5,.5,-.5+C,-.5,.5,-.5,-.5,.5,.5-C,-.5,-.5,.5-C,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-C,-.5,.5,-.5+C,-.5,.5-O,-.5+C,-.5,.5-O,.5-C,-.5,.5-O,.5-C,-.5,.5,.5-C,-.5,.5,-.5+C,-.5,-.5+O,-.5+C,-.5,-.5,-.5+C,-.5,-.5,.5-C,-.5,-.5,.5-C,-.5,-.5+O,.5-C,-.5,-.5+O,-.5+C),D.push(0,0,0,1,C,1,C,1,C,0,0,0,1-C,0,1-C,1,1,1,1,1,1,0,1-C,0,C,0,C,O,1-C,O,1-C,O,1-C,0,C,0,C,1-O,C,1,1-C,1,1-C,1,1-C,1-O,C,1-O)),f===!0?(b.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),D.push(1,0,0,1,1,1,0,1,1,0,0,0)):f===!1||(b.push(.5,.5,-.5,.5,-.5,-.5+C,.5,-.5,-.5,.5,-.5,-.5+C,.5,.5,-.5,.5,.5,-.5+C,.5,.5,.5-C,.5,-.5,.5,.5,-.5,.5-C,.5,-.5,.5,.5,.5,.5-C,.5,.5,.5,.5,.5,-.5+C,.5,.5-O,.5-C,.5,.5-O,-.5+C,.5,.5-O,.5-C,.5,.5,-.5+C,.5,.5,.5-C,.5,-.5+O,-.5+C,.5,-.5,.5-C,.5,-.5,-.5+C,.5,-.5,.5-C,.5,-.5+O,-.5+C,.5,-.5+O,.5-C),D.push(1,0,1-C,1,1,1,1-C,1,1,0,1-C,0,C,0,0,1,C,1,0,1,C,0,0,0,1-C,0,C,O,1-C,O,C,O,1-C,0,C,0,1-C,1-O,C,1,1-C,1,C,1,1-C,1-O,C,1-O)),q===!0?(b.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),D.push(1,1,1,0,0,0,0,0,0,1,1,1)):q===!1||(b.push(.5,.5,.5,.5,.5,-.5,.5-d,.5,-.5,.5-d,.5,-.5,.5-d,.5,.5,.5,.5,.5,-.5+d,.5,.5,-.5+d,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+d,.5,.5,.5-d,.5,.5,.5-d,.5,.5-C,-.5+d,.5,.5-C,-.5+d,.5,.5-C,-.5+d,.5,.5,.5-d,.5,.5,.5-d,.5,-.5+C,.5-d,.5,-.5,-.5+d,.5,-.5,-.5+d,.5,-.5,-.5+d,.5,-.5+C,.5-d,.5,-.5+C),D.push(1,1,1,0,1-d,0,1-d,0,1-d,1,1,1,d,1,d,0,0,0,0,0,0,1,d,1,1-d,1,1-d,1-C,d,1-C,d,1-C,d,1,1-d,1,1-d,C,1-d,0,d,0,d,0,d,C,1-d,C)),a===!0?(b.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),D.push(1,0,0,1,1,1,0,1,1,0,0,0)):a===!1||(b.push(.5,-.5,.5,.5-d,-.5,-.5,.5,-.5,-.5,.5-d,-.5,-.5,.5,-.5,.5,.5-d,-.5,.5,-.5+d,-.5,.5,-.5,-.5,-.5,-.5+d,-.5,-.5,-.5,-.5,-.5,-.5+d,-.5,.5,-.5,-.5,.5,.5-d,-.5,.5,-.5+d,-.5,.5-C,.5-d,-.5,.5-C,-.5+d,-.5,.5-C,.5-d,-.5,.5,-.5+d,-.5,.5,.5-d,-.5,-.5+C,-.5+d,-.5,-.5,.5-d,-.5,-.5,-.5+d,-.5,-.5,.5-d,-.5,-.5+C,-.5+d,-.5,-.5+C),D.push(1,0,1-d,1,1,1,1-d,1,1,0,1-d,0,d,0,0,1,d,1,0,1,d,0,0,0,1-d,0,d,C,1-d,C,d,C,1-d,0,d,0,1-d,1-C,d,1,1-d,1,d,1,1-d,1-C,d,1-C)),{vs:b,uv:D}}}),H(Y.Style,{"csg.cull.color":I,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":I,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":i/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),$l.forEach(function(f){var R={};R[f+a]=!1,R[f+".toggleable"]=!1,R[f+".axis"]=b,R[f+".start"]=0,R[f+".end"]=i/2,R[f+Xp]=0,H(Y.Style,R,!0)});var ch=function(){this.$4n=[]};ch.$15n=function(Z){var H=new ch;return H.$4n=Z,H},ch.prototype={clone:function(){var i=new ch;return i.$4n=this.$4n.map(function(i){return i.clone()}),i},$19n:function(){return this.$4n},union:function(Z){var K=new gk(this.clone().$4n),q=new gk(Z.clone().$4n);return K.$3n(q),q.$3n(K),q.$6n(),q.$3n(K),q.$6n(),K.$7n(q.$2n()),ch.$15n(K.$2n())},subtract:function(X){var y=new gk(this.clone().$4n),V=new gk(X.clone().$4n);return y.$6n(),y.$3n(V),V.$3n(y),V.$6n(),V.$3n(y),V.$6n(),y.$7n(V.$2n()),y.$6n(),ch.$15n(y.$2n())},intersect:function(I){var E=new gk(this.clone().$4n),u=new gk(I.clone().$4n);return E.$6n(),u.$3n(E),u.$6n(),E.$3n(u),u.$3n(E),E.$7n(u.$2n()),E.$6n(),ch.$15n(E.$2n())},inverse:function(){var k=this.clone();return k.$4n.map(function(e){e.flip()}),k}},ch.cube=function(v){v=v||{};var U=new oq(v.center||[0,0,0]),i=v.radius?v.radius.length?v.radius:[v.radius,v.radius,v.radius]:[1,1,1];return ch.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(t){return new _r(t[0].map(function(r){var I=new oq(U.x+i[0]*(2*!!(1&r)-1),U.y+i[1]*(2*!!(2&r)-1),U.z+i[2]*(2*!!(4&r)-1));return new kq(I,new oq(t[1]))}))}))},ch.sphere=function(V){function Y(Z,s){Z*=2*i,s*=i;var G=new oq(h(Z)*K(s),h(s),K(Z)*K(s));S.push(new kq(H.$20n(G.$21n(D)),G))}V=V||{};for(var S,H=new oq(V.center||[0,0,0]),D=V.radius||1,z=V.slices||16,a=V.stacks||8,u=[],$=0;z>$;$++)for(var k=0;a>k;k++)S=[],Y($/z,k/a),k>0&&Y(($+1)/z,k/a),a-1>k&&Y(($+1)/z,(k+1)/a),Y($/z,(k+1)/a),u.push(new _r(S));return ch.$15n(u)},ch.cylinder=function(z){function F(M,d,s){var I=2*d*i,b=f.$21n(h(I)).$20n(y.$21n(K(I))),V=m.$20n(Z.$21n(M)).$20n(b.$21n(S)),j=b.$21n(1-O(s)).$20n(u.$21n(s));return new kq(V,j)}z=z||{};for(var m=new oq(z.start||[0,-1,0]),E=new oq(z.end||[0,1,0]),Z=E.$13n(m),S=z.radius||1,W=z.slices||16,u=Z.$14n(),b=O(u.y)>.5,f=new oq(b,!b,0).cross(u).$14n(),y=f.cross(u).$14n(),L=new kq(m,u.$11n()),x=new kq(E,u.$14n()),j=[],G=0;W>G;G++){var Q=G/W,o=(G+1)/W;j.push(new _r([L,F(0,Q,-1),F(0,o,-1)])),j.push(new _r([F(0,o,0),F(0,Q,0),F(1,Q,0),F(1,o,0)])),j.push(new _r([x,F(1,o,1),F(1,Q,1)]))}return ch.$15n(j)};var oq=function(_,q,S){var g=this;3==arguments.length?(g.x=_,g.y=q,g.z=S):"x"in _?(g.x=_.x,g.y=_.y,g.z=_.z):(g.x=_[0],g.y=_[1],g.z=_[2])};oq.prototype={clone:function(){return new oq(this.x,this.y,this.z)},$11n:function(){return new oq(-this.x,-this.y,-this.z)},$20n:function(D){return new oq(this.x+D.x,this.y+D.y,this.z+D.z)},$13n:function(S){return new oq(this.x-S.x,this.y-S.y,this.z-S.z)},$21n:function(R){return new oq(this.x*R,this.y*R,this.z*R)},$16n:function(_){return new oq(this.x/_,this.y/_,this.z/_)},dot:function(T){return this.x*T.x+this.y*T.y+this.z*T.z},lerp:function(S,l){return this.$20n(S.$13n(this).$21n(l))},length:function(){return C(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(z){var T=this;return new oq(T.y*z.z-T.z*z.y,T.z*z.x-T.x*z.z,T.x*z.y-T.y*z.x)}};var kq=function(G,R,u){var k=this;k.$24n=new oq(G),k.$22n=R?new oq(R):null,k.uv=u?new oq(u):null};kq.prototype={clone:function(){var f=this;return new kq(f.$24n.clone(),f.$22n.clone(),f.uv?f.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(T,v){var Z=this;return new kq(Z.$24n.lerp(T.$24n,v),Z.$22n.lerp(T.$22n,v),Z.uv?Z.uv.lerp(T.uv,v):null)}};var kg=function(X,b){this.$22n=X,this.w=b};kg.$17n=function(H,_,c){var o=_.$13n(H).cross(c.$13n(H)).$14n();return new kg(o,o.dot(H))},kg.prototype={clone:function(){return new kg(this.$22n.clone(),this.w)},flip:function(){var y=this;y.$22n=y.$22n.$11n(),y.w=-y.w},$5n:function(m,q,h,a,d){for(var g=this,r=0,D=1,l=2,M=3,x=0,F=[],t=0;t<m.$9n.length;t++){var c=g.$22n.dot(m.$9n[t].$24n)-g.w,w=-n>c?l:c>n?D:r;x|=w,F.push(w)}switch(x){case r:(g.$22n.dot(m.$8n.$22n)>0?q:h).push(m);break;case D:a.push(m);break;case l:d.push(m);break;case M:for(var Y=[],v=[],t=0;t<m.$9n.length;t++){var X=(t+1)%m.$9n.length,u=F[t],Z=F[X],U=m.$9n[t],$=m.$9n[X];if(u!=l&&Y.push(U),u!=D&&v.push(u!=l?U.clone():U),(u|Z)==M){var c=(g.w-this.$22n.dot(U.$24n))/g.$22n.dot($.$24n.$13n(U.$24n)),C=U.$18n($,c);Y.push(C),v.push(C.clone())}}Y.length>=3&&a.push(new _r(Y,m.$10n)),v.length>=3&&d.push(new _r(v,m.$10n))}}};var _r=function(L,B){var $=this;$.$9n=L,$.$10n=B,$.$8n=kg.$17n(L[0].$24n,L[1].$24n,L[2].$24n)};_r.prototype={clone:function(){var b=this.$9n.map(function(h){return h.clone()});return new _r(b,this.$10n)},flip:function(){this.$9n.reverse().map(function(G){G.flip()}),this.$8n.flip()}};var gk=function(U){var x=this;x.$8n=null,x.front=null,x.back=null,x.$4n=[],U&&x.$7n(U)};gk.prototype={clone:function(){var o=this,l=new gk;return l.$8n=o.$8n&&o.$8n.clone(),l.front=o.front&&o.front.clone(),l.back=o.back&&o.back.clone(),l.$4n=o.$4n.map(function(t){return t.clone()}),l},$6n:function(){for(var L=this,Y=0;Y<L.$4n.length;Y++)L.$4n[Y].flip();L.$8n&&L.$8n.flip(),L.front&&L.front.$6n(),L.back&&L.back.$6n();var f=L.front;L.front=L.back,L.back=f},$1n:function(E){var u=this;if(!u.$8n)return E.slice();for(var t=[],g=[],H=0;H<E.length;H++)u.$8n.$5n(E[H],t,g,t,g);return u.front&&(t=u.front.$1n(t)),g=u.back?u.back.$1n(g):[],t.concat(g)},$3n:function(C){var $=this;$.$4n=C.$1n($.$4n),$.front&&$.front.$3n(C),$.back&&$.back.$3n(C)},$2n:function(){var w=this,o=w.$4n.slice();return w.front&&(o=o.concat(w.front.$2n())),w.back&&(o=o.concat(w.back.$2n())),o},$7n:function(e){var C=this;if(e.length){C.$8n||(C.$8n=e[0].$8n.clone());for(var f=[],V=[],p=0;p<e.length;p++)this.$8n.$5n(e[p],C.$4n,C.$4n,f,V);f.length&&(C.front||(C.front=new gk),this.front.$7n(f)),V.length&&(C.back||(C.back=new gk),C.back.$7n(V))}}};var Ie="symbol",jl=Y.Symbol=function($,E,U){var t=this;B(jl,t),t.s3(20,20,20),t.s({"all.visible":!1,shape:"rect"}),t.setIcon($,E,U)};Ee("Symbol",r,{setIcon:function(s,d,Y){var C,e=this;return jl.superClass.setIcon.call(e,s),s?(C={for3d:!0,face:"center",position:44,names:[s]},Y&&(C.transaprent=!0),d&&(C.autorotate=d),e.addStyleIcon(Ie,C)):e.removeStyleIcon(Ie),e.setWidth(X.getImageWidth(V.getImage(s),e)||20),C}});var ps=Y.CSGNode=function(){B(ps,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},ce={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};Ee("CSGNode",r,{_22Q:function(){return rk},onPropertyChanged:function(F){var d=this,S=d.getHost();ps.superClass.onPropertyChanged.call(d,F),ce[F.property]&&(S instanceof Nc||S instanceof ps)&&S.fp("csgNodeChange",!0,!1)}});var rk=function(K,y){B(rk,this,[K,y])};y(rk,z.Node3dUI,{_80o:function(A,y,O){var X=this;X._shape3d?rk.superClass._80o.call(X,A,y,O):(L(X.gv),Kl.forEach(function(P){Z(X,A,y,P,O)}))},validate:function(p,j){var t=this,z=t.gv,y=t.data;if(y.s("shape3d"))return rk.superClass.validate.call(t,p,j),t._shape3d=!0,void 0;t._shape3d=!1;var q=u(y,z.getMat(y));y.appendAnchorMatrix3d(q);var E=p&&p.uv;t.vf2("csg",E);for(var Z=0;6>Z;Z++)for(var H=$l[Z],s=sn[Z],a=t.vf2(H,E,j),W=a.mat||q,e=a.vs,L=a.uv,l=a.tuv,O=0;2>O;O++){var Y=x[s+3*O],S=x[s+3*O+1],G=x[s+3*O+2];if(U(e,W,[F[3*Y],F[3*Y+1],F[3*Y+2]]),U(e,W,[F[3*S],F[3*S+1],F[3*S+2]]),U(e,W,[F[3*G],F[3*G+1],F[3*G+2]]),l)if(L){var c=8*Z;l.push(L[2*Y-c],L[2*Y+1-c],L[2*S-c],L[2*S+1-c],L[2*G-c],L[2*G+1-c])}else l.push(A[2*Y],A[2*Y+1],A[2*S],A[2*S+1],A[2*G],A[2*G+1])}Mo(t,p,j)},vf2:function(m,q,u){var s,N=this,e=N.gv.getFaceVisible(N.data,m);return s=J(N,m,u),s.vs=[],s.tuv=e&&(s.texture||q)?[]:k,s.visible=e,s}});var Nc=Y.CSGShape=function(){var F=this;B(Nc,F),F.s({"shape.background":k,"2d.hostable":!0,"shape.border.width":8}),F.setTall(240),F.setElevation(120),F.setThickness(14)};Ee("CSGShape",m,{IRotatable:!1,_22Q:function(){return $f},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var $f=function(q,v){B($f,this,[q,v])};y($f,z.Shape3dUI,{_80o:function(w,K,t){var v=this;v.undrawable||(L(v.gv),Kl.forEach(function(W){Z(v,w,K,W,t)}))},validate:function(z,a){var m=this,O=m.data,e=O.getPoints();if(m.undrawable=e.size()<2)return m.clear(),void 0;var M=O.isClosePath(),V=l(O._thickness/2,n),$=E(e,k,k,M);Kl.forEach(function(Q){m.vf(Q,z&&z.uv,!0,a)}),M&&(m.left.visible=!1,m.right.visible=!1),m._12O($,V),m._20Q($);var v=O.getPointsMatrix3d(),L=Y.Math.requestVector3();$l.forEach(function(R){if(m[R])for(var K=m[R].vs,F=0,i=K.length;i>F;F+=3)L.set(K[F],K[F+1],K[F+2]).applyMatrix4(v),K[F]=L.x,K[F+1]=L.y,K[F+2]=L.z}),Y.Math.releaseVector3(L),Mo(m,z,a)}});var de=Y.DoorWindow=function(){var e=this;B(de,e),e.setElevation(100),e.s3(100,200,14)};Ee("DoorWindow",ps,{IDoorWindow:!0,toggle:function(V){this.setExpanded(!this.s(P),V)},isExpanded:function(){return this.s(P)},setExpanded:function(n,u){var B=this,b=B.$25n,R=B.s(P);if(b&&(b.stop(!0),delete B.$25n),R!==n){B.beginTransaction();var h=n?B.s("dw.end"):B.s("dw.start");B.s(P,n),u=o(u),u?(R=B.s(sl),u.action=function(A){B.s(sl,R+(h-R)*A)},u.finishFunc=function(){B.endTransaction()},B.$25n=N(u)):(B.s(sl,h),B.endTransaction())}},getMat:function(){var r=this,K=r.s("dw.s3"),_=r.s("dw.t3"),B=r.s("dw.flip"),F=r.s(sl);if(K||F||_||B){var Z=[];if(B&&Z.push({r3:[0,i,0]}),K&&Z.push({s3:K}),F){K=r.getFinalScale3d();var s=r.s("dw.axis"),C=K[0]/2,o=K[1]/2;K[2]/2,s===b?Z.push({t3:[C,0,0]},{r3:[0,-F,0]},{t3:[-C,0,0]}):s===j?Z.push({t3:[-C,0,0]},{r3:[0,F,0]},{t3:[C,0,0]}):s===w?Z.push({t3:[0,-o,0]},{r3:[-F,0,0]},{t3:[0,o,0]}):s===S?Z.push({t3:[0,o,0]},{r3:[F,0,0]},{t3:[0,-o,0]}):s===e?Z.push({r3:[0,F,0]}):s===c&&Z.push({r3:[F,0,0]})}return _&&Z.push({t3:_}),D(Z)}return k}});var Je=Y.CSGBox=function(){var k=this;B(Je,k),k.setElevation(100),k.s3(100,200,100)};Ee("CSGBox",ps,{ICSGBox:!0,toggleFace:function(l,t){this.setFaceExpanded(l,!this.s(l+a),t)},isFaceExpanded:function(i){return this.s(i+a)},setFaceExpanded:function(T,e,O){var g=this,G=g.$25n,V=g.s(T+a);if(G&&(G.stop(!0),delete g.$25n),V!==e){var z=e?g.s(T+".end"):g.s(T+".start");g.s(T+a,e),O=o(O),O?(V=g.s(T+Xp),O.action=function(J){g.s(T+Xp,V+(z-V)*J)},g.$25n=N(O)):g.s(T+Xp,z)}},getFaceMat:function(a){var _=this,p=_.s(a+Xp);if(!p)return k;var h,q,j,e,A,V,d=_.s(a+".axis"),x=_.getFinalScale3d(),o=_.getAnchor3d(),G=x[0]*o.x,L=x[1]*o.y,c=x[2]*o.z,H=x[0]-G,W=x[1]-L,i=x[2]-c,C=a+"_"+d;switch(C){case"front_left":h=-G,q=0,j=i,e=0,A=-p,V=0;break;case"front_right":h=H,q=0,j=i,e=0,A=p,V=0;break;case"front_top":h=0,q=W,j=i,e=-p,A=0,V=0;break;case"front_bottom":h=0,q=-L,j=i,e=p,A=0,V=0;break;case"front_h":h=0,q=0,j=i,e=p,A=0,V=0;break;case"front_v":h=0,q=0,j=i,e=0,A=p,V=0;break;case"back_left":h=H,q=0,j=-c,e=0,A=-p,V=0;break;case"back_right":h=-G,q=0,j=-c,e=0,A=p,V=0;break;case"back_top":h=0,q=W,j=-c,e=p,A=0,V=0;break;case"back_bottom":h=0,q=-L,j=-c,e=-p,A=0,V=0;break;case"back_h":h=0,q=0,j=-c,e=p,A=0,V=0;break;case"back_v":h=0,q=0,j=-c,e=0,A=p,V=0;break;case"left_left":h=-G,q=0,j=-c,e=0,A=-p,V=0;break;case"left_right":h=-G,q=0,j=i,e=0,A=p,V=0;break;case"left_top":h=-G,q=W,j=0,e=0,A=0,V=-p;break;case"left_bottom":h=-G,q=-L,j=0,e=0,A=0,V=p;break;case"left_h":h=-G,q=0,j=0,e=0,A=0,V=p;break;case"left_v":h=-G,q=0,j=0,e=0,A=p,V=0;break;case"right_left":h=H,q=0,j=i,e=0,A=-p,V=0;break;case"right_right":h=H,q=0,j=-c,e=0,A=p,V=0;break;case"right_top":h=H,q=W,j=0,e=0,A=0,V=p;break;case"right_bottom":h=H,q=-L,j=0,e=0,A=0,V=-p;break;case"right_h":h=H,q=0,j=0,e=0,A=0,V=p;break;case"right_v":h=H,q=0,j=0,e=0,A=p,V=0;break;case"top_left":h=-G,q=W,j=0,e=0,A=0,V=p;break;case"top_right":h=H,q=W,j=0,e=0,A=0,V=-p;break;case"top_top":h=0,q=W,j=-c,e=-p,A=0,V=0;break;case"top_bottom":h=0,q=W,j=i,e=p,A=0,V=0;break;case"top_h":h=0,q=W,j=0,e=p,A=0,V=0;break;case"top_v":h=0,q=W,j=0,e=0,A=0,V=p;break;case"bottom_left":h=-G,q=-L,j=0,e=0,A=0,V=-p;break;case"bottom_right":h=H,q=-L,j=0,e=0,A=0,V=p;break;case"bottom_top":h=0,q=-L,j=i,e=-p,A=0,V=0;break;case"bottom_bottom":h=0,q=-L,j=-c,e=p,A=0,V=0;break;case"bottom_h":h=0,q=-L,j=0,e=p,A=0,V=0;break;case"bottom_v":h=0,q=-L,j=0,e=0,A=0,V=p}return D([{t3:[-h,-q,-j]},{r3:[e,A,V]},{t3:[h,q,j]}])}});var rs=function(e,I,v,S,h){function x(){var L,F=[],T=new f,S=new f;for(Y.eachShapeModel(function(V,p,M){for(var i=0,A=p?p.length:V.length/3;A>i;i++)p?(T.fromArray(V,3*p[i]),S.fromArray(M,3*p[i])):(T.fromArray(V,3*i),S.fromArray(M,3*i)),l(F,T,S)}),F=O(F,V.set(1,0,0)),F=O(F,V.set(-1,0,0)),F=O(F,V.set(0,1,0)),F=O(F,V.set(0,-1,0)),F=O(F,V.set(0,0,1)),F=O(F,V.set(0,0,-1)),L=0;L<F.length;L++){var e=F[L];D.push(.5+e.position.x/h.x,.5-e.position.y/h.y),e.position.applyMatrix4(c),k.push(e.position.x,e.position.y,e.position.z),j.push(e.$22n.x,e.$22n.y,e.$22n.z)}}function l(T,z,H){z.applyMatrix4(g),z.applyMatrix4(p),H.transformDirection(g),H.transformDirection(p),T.push(new t(z.clone(),H.clone()))}function O(W,U){for(var i=[],t=.5*Math.abs(h.dot(U)),f=0;f<W.length;f+=3){var H,$,b,Z,o,C,Q,D=0,X=W[f+0].position.dot(U)-t,N=W[f+1].position.dot(U)-t,n=W[f+2].position.dot(U)-t;switch(H=X>0,$=N>0,b=n>0,D=(H?1:0)+($?1:0)+(b?1:0)){case 0:i.push(W[f]),i.push(W[f+1]),i.push(W[f+2]);break;case 1:if(H&&(Z=W[f+1],o=W[f+2],C=u(W[f],Z,U,t),Q=u(W[f],o,U,t)),$){Z=W[f],o=W[f+2],C=u(W[f+1],Z,U,t),Q=u(W[f+1],o,U,t),i.push(C),i.push(o.clone()),i.push(Z.clone()),i.push(o.clone()),i.push(C.clone()),i.push(Q);break}b&&(Z=W[f],o=W[f+1],C=u(W[f+2],Z,U,t),Q=u(W[f+2],o,U,t)),i.push(Z.clone()),i.push(o.clone()),i.push(C),i.push(Q),i.push(C.clone()),i.push(o.clone());break;case 2:H||(Z=W[f].clone(),o=u(Z,W[f+1],U,t),C=u(Z,W[f+2],U,t),i.push(Z),i.push(o),i.push(C)),$||(Z=W[f+1].clone(),o=u(Z,W[f+2],U,t),C=u(Z,W[f],U,t),i.push(Z),i.push(o),i.push(C)),b||(Z=W[f+2].clone(),o=u(Z,W[f],U,t),C=u(Z,W[f+1],U,t),i.push(Z),i.push(o),i.push(C));break;case 3:}}return i}function u(p,C,s,x){var Q=p.position.dot(s)-x,T=C.position.dot(s)-x,V=Q/(Q-T),m=new t(new f(p.position.x+V*(C.position.x-p.position.x),p.position.y+V*(C.position.y-p.position.y),p.position.z+V*(C.position.z-p.position.z)),new f(p.$22n.x+V*(C.$22n.x-p.$22n.x),p.$22n.y+V*(C.$22n.y-p.$22n.y),p.$22n.z+V*(C.$22n.z-p.$22n.z)));return m}var k=[],j=[],D=[],V=new f,Y=e.getData3dUI(I);if(Y.mat){var g=(new W).fromArray(Y.mat),A=new W;A.makeRotationFromEuler(S),A.setPosition(v);var p=(new W).getInverse(A),c=(new W).scale({x:1/h.x,y:1/h.y,z:1/h.z});return x(),{vs:k,ns:j,uv:D}}};t.prototype.clone=function(){return new t(this.position.clone(),this.$22n.clone())};var Oe=function(z,B,E,o){var q=this,G=q.getDataAt(z);if(G){var T=q.intersectObject(z,G);if(T){"object"==typeof B?B=B.x?new f(B.x,B.y,B.z):new f(B[0],B[1],B[2]):(B=B||20,B=new f(B,B,B)),E=E===I?.1:E;var N=new f(q.getUp()),i=new f(q.getCenter()).sub(new f(q.getEye())).normalize(),s="cross",M=i.clone()[s](N).normalize();N.copy(M)[s](i).normalize(),o&&N.applyAxisAngle(T.worldNormal,-o);var R=new Y.Node,F=T.worldNormal.clone().setLength(E).add(T.world),Q=(new W).lookAt(T.worldNormal.clone(),new f(0,0,0),N),S=(new $).setFromRotationMatrix(Q),y=rs(q,G,T.world.clone(),S,B);return R.p3(F.x,F.y,F.z),R.setEuler(S),R.s3(B.x,B.y,B.z),R.s({shape3d:y,"shape3d.reverse.flip":!0}),R}}};H(Y.graph3d.Graph3dView,{createDecal:Oe})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);